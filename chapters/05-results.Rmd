# Results

```{r read-results, eval = FALSE}
rec_results <- read_rds("data/sim-recovery.rds")
full_results <- read_rds("data/sim-results.rds") %>%
  pluck("all_results") %>%
  bind_rows()

rec_results <- rec_results %>%
  ungroup() %>%
  mutate(
    cond = factor(cond),
    attributes = factor(attributes, levels = c(3, 4), labels = c("3 Attributes",
      "4 Attributes")),
    sample_size = factor(sample_size),
    over_spec = factor(over_spec, levels = c(0, 0.1, 0.2),
      labels = c("Over Specification:\n0.0", "Over Specification:\n0.1",
        "Over Specification:\n0.2")),
    model = factor(model, levels = c("satr", "siml", "meas", "strc",
      "meas-strc", "strc-meas"), labels = c("Saturated", "Simultaneous",
        "Measurement", "Structural", "Measurement-Structural",
        "Structural-Measurement"))
  )
```

Results from the simulation study are described in two sections. Section \@ref(pval-results) summarizes the performance of the reduction processes when the parameters to reduce were determined by p-values from a converged model. Section \@ref(heur-results) summarizes results of the reduction processes a model did not converge, and the parameters to reduce were determined by the higher order interaction heuristic.

Table \@ref(tab:satr-converge) shows...

```{r satr-converge, eval = FALSE}
satr_con <- full_results %>%
  filter(model == "satr") %>%
  group_by(attributes, sample_size, over_spec) %>%
  summarize(convergence_rate = mean(converge)) %>%
  mutate(col_label = map2_chr(attributes, sample_size, function(x, y) {
    paste0(x, "_", y)
  })) %>%
  ungroup() %>%
  select(over_spec, col_label, convergence_rate) %>%
  spread(key = col_label, value = convergence_rate) %>%
  select(over_spec, `3_500`, `3_1000`, `3_5000`, `4_500`, `4_1000`, `4_5000`)

colnames(satr_con) <- c("Q-Matrix Over Specification", "n = 500", "n = 1000",
  "n = 5000", "n = 500", "n = 1000", "n = 5000")

knitr::kable(satr_con, align = "c", booktabs = TRUE,
  caption = "Saturated model convergence rates") %>%
  kable_styling(latex_options = "hold_position") %>%
  add_header_above(c(" " = 1, "3 Attributes" = 3, "4 Attributes" = 3))
```


Figure \@ref(fig:pvalue-converge) shows the convergence rates for the reduction processes when the fully saturated model converged...

```{r pvalue-converge, fig.width = 8, fig.height = 8, out.width = "90%", fig.cap = "Convergence rates when reducing using p-values", fig.pos = "h", eval = FALSE}
p <- rec_results %>% 
  filter(satr_converge == TRUE, model != "Saturated") %>%
  ggplot(aes(x = sample_size, y = converge, group = model, fill = model)) +
  facet_grid(over_spec ~ attributes) +
  geom_col(width = 0.7, position = position_dodge(width = 0.7)) +
  scale_fill_OkabeIto() +
  expand_limits(y = c(0, 1)) +
  labs(x = "Sample Size", y = "Convergence Rate", fill = "Reduction\nProcess") +
  theme_bw() +
  theme(legend.position = "bottom", panel.grid.major.x = element_blank())

ggsave(filename = "pvalue-converge.pdf", plot = p, path = "figure", width = 8,
  height = 8, units = "in", dpi = "retina")
ggsave(filename = "pvalue-converge.png", plot = p, path = "figure", width = 8,
  height = 8, units = "in", dpi = "retina")

knitr::include_graphics("figure/pvalue-converge.pdf")
```

Figure \@ref(fig:rule-converge) shows...

```{r rule-converge, fig.width = 8, fig.height = 8, out.width = "90%", fig.cap = "Convergence rates when reducing using heuristic", fig.pos = "h", eval = FALSE}
p <- rec_results %>% 
  filter(satr_converge == FALSE, model != "Saturated") %>%
  ggplot(aes(x = sample_size, y = converge, group = model, fill = model)) +
  facet_grid(over_spec ~ attributes) +
  geom_col(width = 0.7, position = position_dodge(width = 0.7)) +
  scale_fill_OkabeIto() +
  expand_limits(y = c(0, 1)) +
  labs(x = "Sample Size", y = "Convergence Rate", fill = "Reduction\nProcess") +
  theme_bw() +
  theme(legend.position = "bottom", panel.grid.major.x = element_blank())

ggsave(filename = "rule-converge.pdf", plot = p, path = "figure", width = 8,
  height = 8, units = "in", dpi = "retina")
ggsave(filename = "rule-converge.png", plot = p, path = "figure", width = 8,
  height = 8, units = "in", dpi = "retina")

knitr::include_graphics("figure/rule-converge.pdf")
```

## Reduction by p-value {#pval-results}


## Reduction by heuristic {#heur-results}